---
title: "CTR Model Performance Monthly Report"
author: "Gloria"
date: "Wednesday, January 28, 2015"
output: html_document
---



In this report, I'm trying to look at the overall performances for CTR mashup models across the major Ad exchanges(i.e. Mopub, Smaato, Nexage), and trying to answer the following questions to better understand our work, strengths and weaknesses.

> * Data collected from _aggr skeleton resp_, date ranges from Jan 01, 2015 to Jan 29, 2015.
> * Data excludes the following campaigns: toys r us, babies r us, milk, csv, A&F,JJ

```{r,echo=F}
setwd("C:/Users/Gloria/Documents")
data<-read.csv("CTRData.csv")

statedata<-read.csv("devicestatedata.csv")

data$newdate<-strptime(as.character(data$date), "%m/%d/%Y")
data$newdate<-format(data$newdate,"%Y-%m-%d")

#sort date in the regular Year Month Date format
#make it a time series
data<-data[order(data$newdate),]


```


First of all, let's have a sense of our bidding capabilities and impression volumes across these three ad exchanges.

1. how did the major ad exchanges drive the **bidding** volume this month (broken down by device os)?

```{r, echo=F}
table1<-aggregate(as.numeric(as.character(data$bids)),by=list(data$ad_exchange,data$device_os),sum)
colnames(table1)<-c("ad_exchange","device_os","SumBids")
table1$SumBids<-format(table1$SumBids,big.mark=",",scientific=F)
table1
```

```{r,echo=FALSE, results='hide',message=FALSE}

install.packages("ggplot2",repos="http://cran.rstudio.com/")
library(ggplot2)
```


```{r, echo=FALSE}
ggplot(aes(x=ad_exchange,y=SumBids,fill= ad_exchange),data=table1)+
  geom_bar(stat="identity")+
  facet_grid( .~ device_os )+
  xlab("Ad Exchange") + 
  ylab("January Bidding Volume")+
  ggtitle("January Bidding Volume Summary (by Device OS)")

```

2. how did the major ad exchanges drive the **impression** volume this month (broken down by device os)?

```{r,echo=F}

table2<-aggregate(as.numeric(as.character(data$imps)),by=list(data$ad_exchange,data$device_os),sum)
colnames(table2)<-c("ad_exchange","device_os","SumImps")
table2$SumImps<-format(table2$SumImps,big.mark=",",scientific=F)
table2


ggplot(aes(x=ad_exchange,y=SumImps,fill= ad_exchange),data=table2)+
  geom_bar(stat="identity")+
  facet_grid(.~device_os)+
  xlab("Ad Exchange") + 
  ylab("January Impression Volume")+
  ggtitle("January Impression Volume Summary (by Device OS)")

```

> * Noted that MoPub iOS and Smaato Android are performing strong in winning impressions from the above plot, especially Smato Android, given its ranking at the third place in bidding volume but jumps to second place in impression volume, which indicates a strong win rate.( further analysis: might interested in checking with its bidding price, bidding strategies and margin so that to shed light on other ad exchanges)

3. how did each **Preference**(App & Site) drive the **bidding** volume this month, respectively?

```{r, echo=F}
table3<-aggregate(data$bids,by=list(data$ad_exchange,data$preference),sum)
colnames(table3)<-c("ad_exchange","preference","SumBids")
table3$SumBids<-format(table3$SumBids,big.mark=",",scientific=F)
table3


ggplot(aes(x=ad_exchange,y=SumBids,fill= ad_exchange),data=table3)+
  geom_bar(stat="identity")+
  facet_wrap( ~ preference, ncol=2)+
  xlab("Ad Exchange") + 
  ylab("January Bidding Volume")+
  ggtitle("January Bidding Volume Summary (by Preference)")

```

> * Noted that majority of our bidding (89.95%) focused on _APP_, especially for MoPub with approximately 99% bids with _APP_

> * Smaato has a good chunk of biddings activities on _SITE_


4.how did each **Preference**(App & Site) drive the **impression** volume this month, respectively?

```{r,echo=F}
table4<-aggregate(data$imps,by=list(data$ad_exchange,data$preference),sum)
colnames(table4)<-c("ad_exchange","preference","SumImps")
table4$SumImps<-format(table4$SumImps,big.mark=",",scientific=F)
table4


ggplot(aes(x=ad_exchange,y=SumImps,fill= ad_exchange),data=table4)+
  geom_bar(stat="identity")+
  facet_wrap( ~ preference, ncol=2)+
  xlab("Ad Exchange") + 
  ylab("January Impression Volume")+
  ggtitle("January Impression Volume Summary (by Preference)")

```

> * Same story with Bidding, the majority of our impressions come from _APP_ where MoPub accounts for 56% of the monthly impression volumes on _APP_, followed by Smaato 34.7% and Nexage 9.3%.

> * Further broken down by ad exchanges, MoPub has 99% of the winning impressions coming from _APP_  v.s. 1% from _SITE_; Smaato has 73.4% of the winning impressions from _APP_ v.s. 26.6% on _SITE_; whereas Nexage, 96.2% from _APP_ and 3.8% from _SITE_.

5.how did the three **Creative Types**(Banner, RM, Video) drive the **bidding** volume this month, respectively?

```{r,echo=F}
table5<-aggregate(data$bids,by=list(data$ad_exchange,data$creative_type),sum)
colnames(table5)<-c("ad_exchange","creative_type","SumBids")
table5$SumBids<-format(table5$SumBids,big.mark=",",scientific=F)
table5

ggplot(aes(x=ad_exchange,y=SumBids,fill= ad_exchange),data=table5)+
  geom_bar(stat="identity")+
  facet_wrap( ~ creative_type, ncol=3)+
  xlab("Ad Exchange") + 
  ylab("January Bidding Volume")+
  ggtitle("January Bidding Volume Summary(by Creative Type)")

```

> * Noted that majority of our bidding activities happened on Banner;
* With Static Banner and Rich Media, MoPub is still the biggest inventory to us, followed by Smaato;
* The majority video inventories are provided by SpotX, LiveRail and Mopub, so you might not see data from Nexage and Smaato under video tab
* Nexage Rich Media performs relatively weak

6.how did **Creative Type**(Banner, RM, Video) drive the **impression** volume this month, respectively?

```{r,echo=F}
table6<-aggregate(data$imps,by=list(data$ad_exchange,data$creative_type),sum)
colnames(table6)<-c("ad_exchange","creative_type","SumImps")
table6$SumImps<-format(table6$SumImps,big.mark=",",scientific=F)
table6

ggplot(aes(x=ad_exchange,y=SumImps,fill= ad_exchange),data=table6)+
  geom_bar(stat="identity")+
  facet_wrap( ~ creative_type, ncol=3)+
  xlab("Ad Exchange") + 
  ylab("January Impression Volume")+
  ggtitle("January Impression Volume Summary(by Creative Type)")

```


> * Same story with Bidding, the majority of our impressions come from _Banner_ where MoPub accounts for 56% of the monthly impression volumes on _Banner_, followed by Smaato 34.7% and Nexage 9.3%.

> * Further broken down by ad exchanges, MoPub has 60.5% of the winning impressions coming from _Banner_  v.s. 39.5% from _Rich Media_ v.s. 0.03% from _Video_; Smaato has 87.13% of the winning impressions from _Banner_ v.s. 12.8% on _Rich Media_; whereas Nexage, 93.6% from _Banner_ and 6.4% from _Rich Media_.

7. how did each display size drive the **bidding** volume respectively ?

* Display size combinations:

```{r, echo=F}
table7<-aggregate(data$bids,by=list(data$imp_width,data$imp_height),sum)
colnames(table7)<-c("imp_width","imp_height","SumBids")
table7$SumBids<-format(table7$SumBids,big.mark=",",scientific=F)
table7

```


```{r,echo=F}

ggplot(aes(x=imp_width,y=imp_height,color = SumBids ,size=SumBids),data=table7)+
  geom_point()+
  xlab("Impression Width") + 
  ylab("Impression Height")+
  ggtitle("Bidding Volume Summary By Display Size")

```

```{r,echo=F }
#perc<-round((table7$SumBids[2]/sum(table7$SumBids[1:8])),digits=4)*100
#perc<-paste(perc,"%",sep="")
#perc
```

> * Note: display size 320x50 accounts for approximately 67.91% of the overall bidding volume on January, followed by 728x90 (13.3%) and 320x480 (11.2%)

8. how did each display size drive the **impression** volume respectively ?

```{r, echo=FALSE}
table8<-aggregate(data$imps,by=list(data$imp_width,data$imp_height),sum)
colnames(table8)<-c("imp_width","imp_height","SumImps")
table8$SumImps<-format(table8$SumImps,big.mark=",",scientific=F)
table8
```

```{r,echo=F}

ggplot(aes(x=imp_width,y=imp_height,color = SumImps ,size=SumImps),data=table8)+
  geom_point()+
  xlab("Impression Width") + 
  ylab("Impression Height")+
  ggtitle("Impression Volume Summary By Display size")

```

> * Note: display size 320x50 accounts for approximately 77.6% of the overall impression volume on January, followed by 728x90 (13.2%) and 300x250 (6.8%).

> * Noted that display size 300x250, who swaps the rank with 320x480, jumps to the third place in impression volume given its fourth place in bidding volume, which  indicates a strong win rate of its overall performances on January.
* 320x480 is interstitual

9. Let's take a look at the monthly trend in **CTR** and the **lift** from model OFF to ON, broken down by ad exchange and device os

```{r echo=FALSE, results='hide',message=FALSE, warning=F}
install.packages("dplyr",repos="http://cran.rstudio.com/")
library(dplyr)

date_adx_os_rtdm<-group_by(data,newdate,ad_exchange,device_os,rtdm)
data.dplyr1<-summarise (date_adx_os_rtdm,
                        SumClicks=sum(click),
                        SumImps=sum(imps),
                        ctr= round(100*(sum(click)/sum(imps)),digits=2)
                        )
data.dplyr1<-arrange(data.dplyr1,newdate,ad_exchange,device_os,rtdm)

#format CTR into percentage
#data.dplyr1$CTR<-paste(round(100*data.dplyr1$ctr,digits=2),"%",sep="")
#class(data.dplyr1$CTR)
#x=data.dplyr1$CTR
#as.numeric(substr(x,0,nchar(x)-1))


#change rtdm into factor with levels
data.dplyr1$RTDM <-factor(data.dplyr1$rtdm,
                          levels=c(1,0),
                          labels=c("ON","OFF"))

head(data.dplyr1,n=7)  

ggplot(aes(x=newdate,y=ctr,color=RTDM),data=data.dplyr1)+
  geom_point()+
  facet_grid( ad_exchange ~ device_os) +
  ggtitle("January CTR Curve Over Time (by ad exchange and device os)") +
  scale_x_discrete(breaks = c("2015-01-02","2015-01-16","2015-01-29"))+
  xlab("Date") + 
  ylab("CTR in %")+
  scale_y_continuous(limits=c(0,3))+
  theme(strip.text.x = element_text(size=12, face="bold"),
          strip.text.y = element_text(size=12, face="bold"),
          strip.background = element_rect(colour="#CC6666", fill="#9999CC"))+
  theme(axis.title.x = element_text(size=12,face="bold"),
           axis.title.y=element_text(size=12,face="bold"))

```


> * Mopub iOS has some anomalies/outliers where CTR(off) > CTR(on)
* Generally speaking, the CTR models bring more lift to Android than iOS, especially to MoPub and Smaato
* There seems to be a seasonal(i.e.)weekly trend in the time series plot 
    + for instance, Smaato Android (in the following zoom-in plot), you will see every weekend starting from Friday, the CTR ramps up significantly and spikes on Monday, then drops a little during the weekdays and picks up quickly on Fridays and weekends again (please be advised that 01-02, 01-09, 01-16 and 01-23 are Fridays, every dot represents a daily ctr value).
    + the above phenomenon can be partly explained by our model updates on Friday, the team usually choose to update the models on 1 or 2 days during the early and mid week and Friday. On the other hand, this pattern might also be explained by the more frequent activities people tend to interact with their phones on weekends.
    + I also see sort of the similar stories from the plots with MoPub Android/iOS, Nexage Android/iOS and Smaato iOS
    + Thoughts: If updating the models will quickly drive the ctr performance, we might want to consider real time updating; or from the standpoint of user's behavior, it is also possible that people might tend to interact with their phones more often on weekends, which correlates the ctr spikes on weekends from the graphs.
* Nexage Android CTR model did a great job (ctr >= 1.5%) at the beginning of this month, but gradually touches down to 1%; might need to dive deeper and ask why? (I'll do that)
* Mopub iOS ON and OFF CTRs have the most two volatile plots/patterns in these six scenarioes, and their CTRs change drastically on a day to day basis. Even OFF CTR seems to follow a weekly trend.
* Smaato Android drove the strongest CTR records over the past month (-> my fav combination lol)

> * zoom in with Smaato Android to see the weekly pattern

```{r,echo=F}
subset1<-subset(data.dplyr1,ad_exchange == "Smaato" & device_os == "Android")
ggplot(aes(x=newdate,y=ctr,color=RTDM),data=subset1)+
  geom_point()+
  ggtitle("January CTR Curve Over Time (Smaato Android)") +
  xlab("Date") + 
  ylab("CTR in %")+
  scale_y_continuous(limits=c(0,3))+
  scale_x_discrete(breaks = c("2015-01-02","2015-01-09","2015-01-16","2015-01-23","2015-01-29"))
  
```

> * zoom in the plot to see the similar pattern with MoPub Android 

```{r, warning=F, echo=F}
subset2<-subset(data.dplyr1,ad_exchange == "MoPub" & device_os == "Android")
ggplot(aes(x=newdate,y=ctr,color=RTDM),data=subset2)+
  geom_point()+
  ggtitle("January CTR Curve Over Time (MoPub iOS)") +
  xlab("Date") + 
  ylab("CTR in %")+
  scale_y_continuous(limits=c(0,3))+
  scale_x_discrete(breaks = c("2015-01-02","2015-01-09","2015-01-16","2015-01-23","2015-01-29"))
  
```

10. Let's take a look at the monthly trend in **CTR** and the **lift** from model OFF to ON, broken down by ad exchange and preference


```{r echo=FALSE, results='hide',message=FALSE,warning=F}

date_adx_pf_rtdm<-group_by(data,newdate,ad_exchange,preference,rtdm)
data.dplyr2<-summarise (date_adx_pf_rtdm,
                        SumClicks=sum(click),
                        SumImps=sum(imps),
                        ctr= round(100*(sum(click)/sum(imps)),digits=2)
                        )
data.dplyr2<-arrange(data.dplyr2,newdate,ad_exchange,preference,rtdm)

#change rtdm into factor with levels
data.dplyr2$RTDM <-factor(data.dplyr2$rtdm,
                          levels=c(1,0),
                          labels=c("ON","OFF"))

head(data.dplyr2,n=7)

ggplot(aes(x=newdate,y=ctr,color=RTDM),data=data.dplyr2)+
  geom_point()+
  facet_grid( ad_exchange ~ preference) +
  ggtitle("January CTR Curve Over Time (by ad exchange and preference)") +
  scale_x_discrete(breaks = c("2015-01-02","2015-01-16","2015-01-29"))+
  xlab("Date") + 
  ylab("CTR in %")+
  scale_y_continuous(limits=c(0,4))+
  theme(strip.text.x = element_text(size=12, face="bold"),
          strip.text.y = element_text(size=12, face="bold"),
          strip.background = element_rect(colour="#CC6666", fill="#9999CC"))+
  theme(axis.title.x = element_text(size=12,face="bold"),
           axis.title.y=element_text(size=12,face="bold"))
  

```



> * Overally speaking, Smaato saw the biggest lift in CTR on both APP and SITE, 2-5 times! bring it.
* At the ending two weeks of January, CTR of Smaato on APP ramps up stably whereas that of SITE decreases week by week (need to dive in and find why? I'll dig into)
* MoPub has the most volatile inventory and data distribution, especially with SITE

11. Finally, Let's take a look at the monthly trend in **CTR** and the **lift** from model OFF to ON, broken down by ad exchange and creative type


```{r echo=FALSE, results='hide',message=FALSE,warning=F}

date_adx_c_rtdm<-group_by(data,newdate,ad_exchange,creative_type,rtdm)
data.dplyr3<-summarise (date_adx_c_rtdm,
                        SumClicks=sum(click),
                        SumImps=sum(imps),
                        ctr= round(100*(sum(click)/sum(imps)),digits=2)
                        )
data.dplyr3<-arrange(data.dplyr3,newdate,ad_exchange,creative_type,rtdm)

#change rtdm into factor with levels
data.dplyr3$RTDM <-factor(data.dplyr3$rtdm,
                          levels=c(1,0),
                          labels=c("ON","OFF"))

head(data.dplyr3,n=7)

ggplot(aes(x=newdate,y=ctr,color=RTDM),data=data.dplyr3)+
  geom_point()+
  facet_grid( ad_exchange ~ creative_type) +
  ggtitle("January CTR Curve Over Time (by ad exchange and creative type)") +
  scale_x_discrete(breaks = c("2015-01-02","2015-01-16","2015-01-29"))+
  xlab("Date") + 
  ylab("CTR in %")+
  scale_y_continuous(limits=c(0,4))+
  theme(strip.text.x = element_text(size=12, face="bold"),
          strip.text.y = element_text(size=12, face="bold"),
          strip.background = element_rect(colour="#CC6666", fill="#9999CC"))+
  theme(axis.title.x = element_text(size=12,face="bold"),
           axis.title.y=element_text(size=12,face="bold"))

```

> * For Banner, the model has lifted the clike through rate for approximately 2-3 times
* For Rich Media, especially with MoPub, the CTR has been very volatile.
    + the fact that we are running a bunch of interstitials might explain the high CTR with model OFF.
* Noted that no data is available for nexage and smaato video plates

This is a monthly summary of the CTR models' performances, I hope it gives us a general idea of our strengths/weaknesses/anomalies/discrepencies so that we can better improve things in the next months ahead. please shed light on the analysis from your standpoint when you have a chance and definitely feel free to leave comments, concerns, questions and corrections. I'm more than happy to hear from you! Also thanks for the amazing work, team, keep it up.


Thanks very much,
Gloria


